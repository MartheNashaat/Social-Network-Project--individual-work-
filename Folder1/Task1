# -*- coding: utf-8 -*-
"""Omdena-PlantDisease.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1Fz49_EhWBwOpGaTaYY0I2hHek5xk15It

# Omdena-Plant Disease Object Detection

---

### Imports
"""

import zipfile
import numpy as np
from PIL import Image
import pandas as pd
import xml.etree.cElementTree as et
import csv
import tensorflow as tf

"""## Data Processing

---

### Read XML file
"""

TrainArray=[]
TestArray=[]

Folder=[]
Filename=[]
Path=[]
Source=[]
Size=[]
Segmented=[]
Object=[]
Database=[]
Name=[]
Pose=[]
Truncated=[]
Difficult=[]
Occluded=[]
Width=[]
Height=[]
Depth=[]
Xmin=[]
Xmax=[]
Ymin=[]
Ymax=[]
#Open the zip file
ReadZip = zipfile.ZipFile('/content/drive/MyDrive/Colab Notebooks/PlantDoc.v3-raw.voc.zip', mode='r')
NameList=np.array(ReadZip.namelist() )#Name list of elements

for file in NameList:
  if file.endswith('.xml'):
    x=ReadZip.open(file)  
    tree =et.parse(x)
    root=tree.getroot()
    for name in root.findall('folder'):
      Folder.append(name.find('folder'))
    for name in root.findall('filename'):
      Filename.append(str(name.text))
    for name in root.findall('path'):
      Path.append(str(name.text))
    for name in root.findall('size'):
      value=name[0].text
      Width.append(int(value))
      value1=name[1].text
      Height.append(int(value1))
      value2=name[2].text
      Depth.append(int(value2))
    for name in root.findall('segmented'):
      Segmented.append(name.text)
    for name in root.findall('object'):
      Name.append(str(name[0].text)) #name
      Pose.append(str(name[1].text))
      Truncated.append(int(name[2].text))
      Difficult.append(int(name[3].text))
      Occluded.append(int(name[4].text))

      value1=name.findall('bndbox')
      xmin=int(value1[0][0].text)
      Xmin.append(xmin)
      xmax=int(value1[0][1].text)
      Xmax.append(xmax)
      ymin=int(value1[0][2].text)
      Ymin.append(ymin)
      ymax=int(value1[0][3].text)
      Ymax.append(ymax)

    array_img =np.array(root)
    if file.startswith('train/'):
      TrainArray.append(array_img)
    if file.startswith('test/'):
      TestArray.append(array_img)

TrainArray=np.array(TrainArray)
TestArray=np.array(TestArray)

print(TrainArray.shape)
print(TestArray.shape)

"""### XML to CSV file"""

data=[Folder,Filename,Path,Source,Size,Width,Height,
      Depth,Segmented,Database,
      Name,Pose,
      Truncated,Difficult,Occluded,Object,Xmin,Xmax,Ymin,Ymax]

columns_Name=['Folder','Filename','Path','Source','Size','Width','Height','Depth','Segmented','Database','Name','Pose','Truncated','Difficult','Occluded','Object','Xmin','Xmax','Ymin','Ymax']

Train_DataFrame=pd.DataFrame(data, index=columns_Name)
Train_DataFrame=Train_DataFrame.replace([np.nan],'None')
Train_DataFrame.to_csv("/content/drive/MyDrive/Colab Notebooks/TrainData.csv")
